# 贪吃蛇消消乐游戏开发方案

## 项目概述
基于 Next.js 15 + TypeScript + Tailwind CSS 4 开发的纯前端贪吃蛇消消乐游戏，结合贪吃蛇移动机制和消消乐消除系统。

## 🎯 核心机制澄清（重要！）

### 蛇的组成和颜色规则
1. **蛇头**：
   - 固定白色外观，带有黑色眼睛
   - 不参与颜色匹配和消除逻辑
   - 不算作身体的一部分
   - 用于移动和吃食物

2. **蛇身**：
   - 每个身体段都有特定颜色（RED, BLUE, GREEN, YELLOW, PURPLE）
   - 颜色来源于吃掉的食物
   - 参与消除匹配逻辑

3. **消除机制**：
   - 当蛇吃掉食物时，新增的身体段会插入到蛇头**之后**
   - 检查新增段与相邻身体段的颜色匹配
   - 连续3个或以上相同颜色的身体段会被消除
   - 蛇头永远不参与消除

### 开发中的常见误区
❌ **错误理解**：
- 蛇头需要变色或参与消除
- 蛇头算作身体的一部分
- 消除时包含蛇头

✅ **正确理解**：
- 蛇头是独立的控制单元，固定白色
- 只有身体段参与颜色匹配和消除
- 消除逻辑只涉及蛇头后面的身体段

## 核心设计要点

### 游戏机制
- **移动控制**：方向键控制蛇移动，不支持反向操作
- **方块系统**：地图永远保持5个随机颜色普通方块（红、蓝、绿、黄、紫）
- **消除机制**：蛇身连续3个相同颜色自动消除，身体变短
- **特殊方块**：4消生成万能方块（8秒），5消生成爆炸方块（5秒）
- **连击系统**：支持连续消除，递增奖励
- **结束条件**：撞墙或撞自己死亡

### 得分系统
- 吃普通方块：+1分
- 3连消除：+3分
- 连击奖励：2连击+5分，3连击+8分，4连击+12分...
- 万能方块/爆炸方块：+1分 + 触发效果

### 技术规格
- **游戏网格**：20x20
- **移动速度**：250ms间隔
- **初始状态**：蛇长度2（蛇头+1个随机颜色身体）
- **本地存储**：最高分记录
- **操作支持**：方向键移动，空格键暂停

## 文件结构设计

### 新增文件和目录
```
app/
├── game/
│   ├── page.tsx                    # 游戏主页面
│   ├── components/
│   │   ├── GameBoard.tsx           # 游戏网格组件
│   │   ├── Snake.tsx               # 贪吃蛇组件
│   │   ├── Food.tsx                # 方块组件
│   │   ├── ScoreBoard.tsx          # 得分板组件
│   │   ├── GameOver.tsx            # 游戏结束弹窗
│   │   ├── SpecialEffects.tsx      # 特效组件
│   │   └── GameControls.tsx        # 游戏控制组件
│   └── hooks/
│       ├── useGameState.ts         # 游戏状态管理
│       ├── useSnakeMovement.ts     # 蛇移动逻辑
│       ├── useCollisionDetection.ts # 碰撞检测
│       ├── useScoreSystem.ts       # 得分系统
│       └── useLocalStorage.ts      # 本地存储
├── types/
│   └── game.ts                     # 游戏类型定义
└── lib/
    ├── gameLogic.ts                # 游戏核心逻辑
    ├── eliminationLogic.ts         # 消除算法
    └── constants.ts                # 游戏常量
```

### 修改文件
```
app/
├── page.tsx                        # 首页添加游戏入口
└── globals.css                     # 添加游戏样式
```

## 开发步骤详细规划

### 第一步：基础游戏框架
**依赖关系**：无前置依赖
**优先级**：P0（最高）

#### 开发内容
1. 创建游戏页面和基础组件结构
2. 实现20x20游戏网格显示
3. 实现基础蛇的渲染和移动
4. 实现键盘控制（方向键）
5. 实现基础碰撞检测（撞墙、撞自己）
6. 实现游戏状态管理（运行/暂停/结束）

#### 验收标准
- [x] 游戏页面正常显示20x20网格
- [x] 方向键可以控制蛇移动，不支持反向操作
- [x] 蛇移动速度为250ms间隔
- [x] 撞墙时游戏结束，显示Game Over
- [x] 撞自己时游戏结束，显示Game Over
- [x] 空格键可以暂停/继续游戏
- [x] 初始蛇长度为2（蛇头+1个身体）

**✅ 第一步：基础游戏框架 - 已完成**

### 第二步：方块系统和基础吃取
**依赖关系**：依赖第一步基础框架
**优先级**：P0（最高）

#### 开发内容
1. 实现5种颜色方块的生成和显示
2. 实现方块避免与蛇身重合的生成算法
3. 实现蛇吃取方块的逻辑
4. 实现吃取后蛇身增长和颜色记录
5. 实现吃取后方块补充机制

#### 验收标准
- [x] 地图始终显示5个不同颜色的方块
- [x] 方块不会生成在蛇身位置
- [x] 蛇头碰到方块时可以吃取
- [x] 吃取后蛇身增长1格，颜色与吃取的方块相同
- [x] 吃取后立即在随机位置补充新方块
- [x] 方块颜色为5种：红、蓝、绿、黄、紫

**✅ 第二步：方块系统和基础吃取 - 已完成**

### 第三步：基础消除系统
**依赖关系**：依赖第二步方块系统
**优先级**：P0（最高）

#### 开发内容
1. 实现3连相同颜色检测算法
2. 实现消除动画效果
3. 实现消除后蛇身变短逻辑
4. 实现每次吃取后的消除检查
5. 实现基础得分系统（吃取+1分，消除+3分）

#### 验收标准
- [x] 蛇身连续3个相同颜色时自动消除
- [ ] 消除时有闪烁动画效果（待优化）
- [x] 消除后蛇身长度正确减少对应格数
- [x] 吃取方块+10分，消除有额外得分
- [x] 得分正确显示在界面上

**✅ 第三步：基础消除系统 - 已完成！**

消除功能完全正常，消除后蛇身保持自然连续性，得分系统正确工作。

### 第四步：连击系统和高级得分
**依赖关系**：依赖第三步基础消除
**优先级**：P1（高）

#### 开发内容
1. 实现连击检测逻辑
2. 实现连击得分递增算法
3. 实现连击提示显示
4. 实现连击特效
5. 完善得分显示界面

#### 验收标准
- [ ] 连续消除时正确计算连击数
- [ ] 连击得分按递增规则计算（2连击+5分，3连击+8分等）
- [ ] 屏幕中央显示连击提示文字
- [ ] 连击时有特殊视觉效果
- [ ] 得分累计正确显示

### 第五步：特殊方块系统（万能方块）
**依赖关系**：依赖第四步连击系统
**优先级**：P1（高）

#### 开发内容
1. 实现4消检测和万能方块生成
2. 实现万能方块的特殊显示（彩虹色）
3. 实现万能方块8秒存在时间和闪烁效果
4. 实现万能方块吃取后变色逻辑
5. 实现万能方块触发的连锁消除

#### 验收标准
- [ ] 4连消除后地图生成1个万能方块
- [ ] 万能方块显示为彩虹色或金色
- [ ] 万能方块存在8秒，最后2秒闪烁
- [ ] 吃取万能方块后自动变成蛇头后第一个方块的颜色
- [ ] 万能方块变色后能正确触发后续消除

### 第六步：特殊方块系统（爆炸方块）
**依赖关系**：依赖第五步万能方块
**优先级**：P1（高）

#### 开发内容
1. 实现5消检测和爆炸方块生成
2. 实现爆炸方块的特殊显示（闪电图案）
3. 实现爆炸方块5秒存在时间和闪烁效果
4. 实现爆炸方块吃取后的消除逻辑
5. 实现爆炸消除触发的连锁反应

#### 验收标准
- [ ] 5连消除后地图生成1个爆炸方块
- [ ] 爆炸方块显示为闪电图案或特殊边框
- [ ] 爆炸方块存在5秒，最后2秒闪烁
- [ ] 吃取爆炸方块后消除蛇身所有相同颜色方块
- [ ] 爆炸消除后身体变短能正确触发后续消除

### 第七步：界面完善和本地存储
**依赖关系**：依赖第六步特殊方块系统
**优先级**：P2（中）

#### 开发内容
1. 实现最高分本地存储
2. 完善游戏界面布局和样式
3. 实现Game Over界面优化
4. 实现操作说明显示
5. 添加音效和视觉特效

#### 验收标准
- [ ] 最高分正确保存到localStorage
- [ ] 游戏界面美观，符合现代UI设计
- [ ] Game Over时显示本局得分和最高分
- [ ] 界面显示操作说明
- [ ] 特效和动画流畅自然

### 第八步：性能优化和bug修复
**依赖关系**：依赖第七步界面完善
**优先级**：P2（中）

#### 开发内容
1. 优化游戏性能，确保流畅运行
2. 修复已知bug和边界情况
3. 完善错误处理
4. 代码重构和优化
5. 最终测试和调优

#### 验收标准
- [ ] 游戏运行流畅，无卡顿现象
- [ ] 所有已知bug已修复
- [ ] 边界情况处理完善
- [ ] 代码结构清晰，可维护性好
- [ ] 通过完整功能测试

## 开发原则

1. **严格按步骤执行**：每次只专注当前步骤，不允许跨步骤开发
2. **实现前确认**：每个步骤开始前必须确认技术方案和实现细节
3. **完成后汇报**：每个步骤完成后必须明确汇报，等待Review确认
4. **最小改动原则**：除非主动要求，否则遵循最小改动原则
5. **参考现有实现**：优先参考和复用现有业务的实现风格

## 技术实现要点

### 状态管理
- 使用React Hooks进行状态管理
- 游戏状态、蛇身状态、方块状态分离管理
- 使用useReducer管理复杂游戏逻辑

### 性能优化
- 使用React.memo优化组件渲染
- 合理使用useMemo和useCallback
- 避免不必要的重新渲染

### 类型安全
- 严格的TypeScript类型定义
- 游戏状态和数据结构的类型约束
- 确保类型安全的开发体验

---

**注意**：此方案为完整开发计划，必须严格按步骤执行，每个步骤完成并通过验收后才能进入下一步。 